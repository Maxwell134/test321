name: tom

on:
  workflow_dispatch:
    inputs:
      username: 
        description: username
        type: string
        required: true

      repo:
        description: repository name
        type: string
        required: true


jobs:
  get-collaborators:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Pip install 
        run: pip3 install requests
                    
      - name: Get Collaborators
        run: |
        
          python3 -u ${{ github.workspace }}/.github/workflows/tom.py
          
        env:
          GITHUB_TOKEN: ${{ secrets.TOKEN }}
          username: ${{ github.event.inputs.username }}
          repo: ${{ github.event.inputs.repo }}
          
      - name: Check if comment contains specific text
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const commentBody = context.payload.comment.body.toLowerCase();
            const shouldCloseIssue = commentBody.includes('yes'); // Change this to the specific text you are looking for
  
            if (shouldCloseIssue) {
              github.issues.update({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                state: 'closed'
              });
            }
     
      - name: Wait for 5 minutes
        run: sleep 300  
        
      - name: Next Steps
        if: github.event.comment.body == 'yes' && github.event.issue.state == 'closed'
        run: echo "Successful"
